# Passage Panel for Cloudflare Workers - راهنمای راه‌اندازی

## معرفی

Passage Panel یک پنل مدیریت مدرن برای Cloudflare Workers است که به شما امکان می‌دهد سرویس‌های VPN/Proxy را با پشتیبانی از پروتکل‌های مختلف مدیریت کنید. این پنل با الهام از Passage اصلی طراحی شده و تمام امکانات لازم برای مدیریت حرفه‌ای را فراهم می‌کند.

## ویژگی‌های اصلی

- 🎨 **رابط کاربری مدرن**: طراحی شبیه به Passage با رنگ #C7A46C
- 🌍 **چندزبانه**: پشتیبانی کامل از فارسی و انگلیسی
- 🌓 **تم روشن/تاریک**: قابلیت تغییر بین حالت‌های مختلف
- 🔐 **احراز هویت امن**: سیستم ورود با جلسات امن
- 👥 **مدیریت کاربران**: ایجاد، ویرایش و حذف کاربران با محدودیت ترافیک
- 🌐 **پشتیبانی از پروتکل‌ها**: VLESS, VMESS, Trojan, Shadowsocks
- 📊 **آمار و گزارشات**: مانیتورینگ زنده ترافیک و اتصالات
- 🔗 **سابسکریپشن**: تولید لینک سابسکریپشن برای کلاینت‌ها
- 📱 **QR Code**: تولید کد QR برای کانفیگ‌ها
- 📈 **نمایش اطلاعات کاربر**: نمایش آی‌پی، کشور، پرچم و ISP

## پیش‌نیازها

1. **حساب Cloudflare**: برای استفاده از Cloudflare Workers
2. **دامن ثبت شده**: دامنه‌ای که در Cloudflare مدیریت شود
3. **دانش پایه**: آشنایی با مفاهیم VPN و پروتکل‌ها

## مراحل راه‌اندازی

### مرحله ۱: آماده‌سازی Cloudflare

1. وارد حساب Cloudflare خود شوید
2. دامنه مورد نظر را انتخاب کنید
3. مطمئن شوید که پروکسی Cloudflare برای دامنه فعال است (نارنجی رنگ)

### مرحله ۲: ایجاد Cloudflare Worker

1. به بخش **Workers & Pages** بروید
2. روی **Create application** کلیک کنید
3. **Create Worker** را انتخاب کنید
4. نامی برای ورکر خود انتخاب کنید (مثلاً `passage-panel`)
5. کد `worker.js` را در ادیتور کپی کنید
6. روی **Save and Deploy** کلیک کنید
7. ورکر را دیپلوی کنید

### مرحله ۳: تنظیم دامنه و مسیر

1. پس از دیپلوی، به تب **Triggers** بروید
2. در بخش **Custom Domains**، دامنه خود را اضافه کنید:
   ```
   panel.yourdomain.com
   ```
3. یا می‌توانید از مسیر استفاده کنید:
   ```
   yourdomain.com/panel/*
   ```

### مرحله ۴: راه‌اندازی frontend

1. کد frontend را در ریپازیتوری GitHub خود آپلود کنید
2. در GitHub Pages، Vercel یا Netlify دیپلوی کنید
3. در فایل `.env` یا تنظیمات پروژه، API URL را تنظیم کنید:
   ```
   NEXT_PUBLIC_API_URL=https://your-worker-domain.workers.dev
   ```

### مرحله ۵: تنظیمات اولیه

1. وارد پنل مدیریت شوید:
   - آدرس: `https://panel.yourdomain.com`
   - نام کاربری پیش‌فرض: `admin`
   - رمز عبور پیش‌فرض: `admin`

2. بلافاصله پس از ورود، رمز عبور را تغییر دهید

3. اینباندهای پیش‌فرض را بررسی و تنظیم کنید

## تنظیمات پیشرفته

### تغییر اعتبارنامه‌ها

در فایل `worker.js`، می‌توانید اعتبارنامه‌ها را تغییر دهید:

```javascript
this.settings = {
  adminUsername: "your_username", // تغییر نام کاربری
  adminPassword: "your_password", // تغییر رمز عبور
  // ... سایر تنظیمات
};
```

### محدودیت‌ها

```javascript
this.settings = {
  maxUsers: 100,        // حداکثر تعداد کاربران
  maxInbounds: 50,      // حداکثر تعداد اینباندها
  sessionTimeout: 3600000, // زمان انقضا جلسه (میلی‌ثانیه)
  // ... سایر تنظیمات
};
```

### پیکربندی TLS

برای استفاده از TLS:
1. گواهی SSL را در Cloudflare فعال کنید
2. در تنظیمات اینباندها، TLS را فعال کنید
3. پورت را روی 443 تنظیم کنید

## استفاده از پنل

### ایجاد کاربر جدید

1. به بخش **مدیریت کاربران** بروید
2. روی **افزودن کاربر** کلیک کنید
3. اطلاعات کاربر را وارد کنید:
   - نام کاربری
   - ایمیل
   - پروتکل (VLESS, VMESS, Trojan, Shadowsocks)
   - محدودیت ترافیک (GB)
   - تاریخ انقضا
4. کاربر را ایجاد کنید

### ایجاد اینباند جدید

1. به بخش **اینباندها** بروید
2. روی **ایجاد اینباند** کلیک کنید
3. تنظیمات را پیکربندی کنید:
   - نام (Remark)
   - پروتکل
   - پورت
   - نوع انتقال (TCP, WebSocket, gRPC)
   - TLS
4. اینباند را ایجاد کنید

### تولید کانفیگ برای کاربر

1. در لیست کاربران، روی کاربر مورد نظر کلیک کنید
2. کانفیگ‌های تولید شده را مشاهده کنید
3. از QR Code برای اسکن در کلاینت موبایل استفاده کنید
4. یا کانفیگ را کپی کنید

### سابسکریپشن

1. برای هر کاربر یک لینک سابسکریپشن تولید می‌شود
2. این لینک را در کلاینت‌های VPN وارد کنید:
   - v2rayN
   - v2rayNG
   - Clash
   - Shadowrocket
   - Quantumult X

## عیب‌یابی

### مشکلات رایج

**1. ورود به پنل ممکن نیست**
- اعتبارنامه‌ها را بررسی کنید
- کوکی‌های مرورگر را پاک کنید
- از کش مرورگر استفاده نکنید

**2. کانفیگ‌ها کار نمی‌کنند**
- تنظیمات اینباند را بررسی کنید
- مطمئن شوید پورت باز است
- تنظیمات TLS را بررسی کنید

**3. ترافیک محاسبه نمی‌شود**
- مطمئن شوید ورکر به درستی کار می‌کند
 لاگ‌های Cloudflare را بررسی کنید

**4. خطاهای CORS**
- مطمئن شوید دامنه frontend در تنظیمات ورکر مجاز است
- هدرهای CORS را در `worker.js` بررسی کنید

### لاگ‌ها و مانیتورینگ

1. به داشبورد Cloudflare بروید
2. ورکر خود را انتخاب کنید
3. به تب **Logs** بروید
4. لاگ‌های خطا و درخواست‌ها را مشاهده کنید

## امنیت

### بهترین pratiques

1. **تغییر رمز عبور پیش‌فرض**: بلافاصله پس از نصب رمز عبور را تغییر دهید
2. **استفاده از TLS**: همیشه از HTTPS استفاده کنید
3. **محدود کردن دسترسی**: فقط از IP‌های مجاز اجازه دسترسی دهید
4. **به‌روزرسانی منظم**: ورکر و frontend را به‌روز نگه دارید
5. **پشتیبان‌گیری**: به طور منظم از تنظیمات پشتیبان بگیرید

### فایروال Cloudflare

1. در تنظیمات دامنه، به بخش **Security** > **WAF** بروید
2. قوانین سفارشی برای محافظت از پنل ایجاد کنید:
   - محدود کردن درخواست‌ها به کشورهای خاص
   - مسدود کردن IP‌های مشکوک
   - محدود کردن نرخ درخواست‌ها

## پشتیبانی

- **گیت‌هاب**: برای گزارش باگ‌ها و درخواست‌های ویژگی
- **مستندات**: برای اطلاعات بیشتر به مستندات فنی مراجعه کنید
- **کامیونیتی**: برای پرسش و پاسخ به انجمن‌های مرتبط مراجعه کنید

## لایسنس

این پروژه تحت لایسنس MIT منتشر شده است. برای اطلاعات بیشتر به فایل LICENSE مراجعه کنید.

## تشکر

- تیم Passage برای الهام بخشی
- Cloudflare برای پلتفرم عالی
- جامعه متن‌باز برای کامپوننت‌های استفاده شده